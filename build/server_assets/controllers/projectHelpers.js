'use strict';

var mongoose = require('mongoose');
var Employee = require('../models/Employee.js');
var Template = require('../models/Template.js');
var TemplateTask = require('../models/TemplateTask.js');
var ProjectTask = require('../models/ProjectTask.js');
var Q = require('q');
var timeCtrl = require('../controllers/timeCtrl.js');
var randomstring = require('randomstring');

module.exports = {
  getTaskArray: function getTaskArray(id) {
    console.log("#16 - Made it the Task Array");
    var deferred = Q.defer();
    Template.findById(id).exec().then(function (template) {
      var taskArray = template.tasks;
      deferred.resolve(taskArray);
    });
    return deferred.promise;
  },
  makeTemplateTaskObject: function makeTemplateTaskObject(id, associatedProjectId) {
    console.log("#18 - Made it to Template Task Object");
    var deferred = Q.defer();
    TemplateTask.findById(id).exec().then(function (returnedTask) {
      var task_plain = returnedTask.toObject();
      delete task_plain._id;
      delete task_plain.__v;
      delete task_plain.date.created;
      deferred.resolve(task_plain);
    });
    return deferred.promise;
  },
  makeProjectObject: function makeProjectObject(id) {
    console.log("#2 - Make Project Object Called");
    var deferred = Q.defer();
    Template.findById(id).exec().then(function (template) {
      var new_Object = template.toObject();
      delete new_Object._id;
      delete new_Object.__v;
      delete new_Object.tasks;
      deferred.resolve(new_Object);
    });
    return deferred.promise;
  },
  makeProjectTask: function makeProjectTask(object, associatedProjectId) {
    console.log("#21 Made it to Make Project Task", object, "ASSOCIATEDPROJECTID", associatedProjectId);
    var deferred = Q.defer();
    var newTask = new ProjectTask(object);
    newTask.friendlyId = randomstring.generate({ length: 5, readable: true });
    newTask.associatedProject = associatedProjectId;
    console.log("NEW TASK CREATED", newTask);
    newTask.save().then(function (task) {
      console.log("DID WE MAKE IT?", task);
      deferred.resolve(task._id);
    }).catch(function (err) {
      console.log("ERROR", err);
    });
    return deferred.promise;
  },
  nextOccurrence: function nextOccurrence(template, instance) {
    console.log("#6 - Next Occurance Called");
    console.log("#7 - Interval Type ", template.setup.interval.type);
    var deferred = Q.defer();
    var deadline;
    var intervalType = template.setup.interval.type;
    var path = "template.setup.interval";
    console.log("#8 - Path", path);

    if (intervalType === 'Weekly') {
      if (template.setup.interval.weeklyInterval !== 'Any') {
        deadline = timeCtrl.weeklySpecificDay(template.setup.interval.weeklyInterval, instance);
      } else {
        deadline = timeCtrl.weeklyAnyDay(instance);
      }
    } else if (intervalType === 'Bi-Weekly') {
      if (template.setup.interval.weeklyInterval !== 'Any') {
        deadline = timeCtrl.biWeeklySpecificDay(template.setup.interval.biWeeklyInterval, instance);
      } else {
        deadline = timeCtrl.biWeeklyAnyDay(instance);
      }
    } else if (intervalType === 'Monthly') {
      if (template.setup.interval.monthlyInterval.selection === "First Day of Month") {
        deadline = timeCtrl.monthlyFirstDay();
      } else if (template.setup.interval.monthlyInterval.selection === "Last Day of Month") {
        deadline = timeCtrl.monthlyLastDay(instance);
      } else if (template.setup.interval.monthlyInterval.selection === '# of Days From Start') {
        deadline = timeCtrl.monthlyDaysFromStart(template.setup.interval.monthlyInterval.fromBeginning, instance);
      } else if (template.setup.interval.monthlyInterval.selection === '# of Days Before End') {
        deadline = timeCtrl.monthlyDaysBeforeEnd(template.setup.interval.monthlyInterval.fromEnd, instance);
      } else {
        deadline = timeCtrl.monthlyAnyDay(instance);
      }
    } else if (intervalType === 'Semi-Monthly') {
      deadline = timeCtrl.semiMonthlyFirstCycle(template.setup.interval.semiMonthlyInterval.fromBeginning);
      template.setup.dueDate.anticipated = timeCtrl.semiMonthlySecondCycle(template.setup.interval.semiMonthlyInterval.fromEnd);
    } else if (intervalType === 'Quarterly') {
      if (template.setup.interval.quarterlyInterval.selection === 'First Day of the Quarter') {
        deadline = timeCtrl.quarterlyFirstDay();
      } else if (template.setup.interval.quarterlyInterval.selection === 'Last Day of the Quarter') {
        deadline = timeCtrl.quarterlyLastDay(instance);
      } else if (template.setup.interval.quarterlyInterval.selection === '# Days from Start') {
        deadline = timeCtrl.quarterlyDaysFromStart(template.setup.interval.quarterlyInterval.fromBeginning, instance);
      } else if (template.setup.interval.quarterlyInterval.selection === '# Days from End') {
        deadline = timeCtrl.quarterlyDaysBeforeEnd(template.setup.interval.quarterlyInterval.fromEnd, instance);
      } else {
        deadline = timeCtrl.quarterlyAnyDay(instance);
      }
    } else if (intervalType === 'Annually') {
      console.log("#10 - Made it to the correct type");
      if (template.setup.interval.annualInterval === 'First Day of the Year') {
        deadline = timeCtrl.annuallyFirstDay(instance);
      } else if (template.setup.interval.annualInterval.selection === 'Last Day of the Year') {
        deadline = timeCtrl.annuallyLastDay(instance);
      } else if (template.setup.interval.annualInterval.selection === 'In a Particular Month') {
        console.log("#11 - Make it to the correct annual selection!");
        console.log('template', template.setup.interval.annualInterval.selectMonth);
        deadline = timeCtrl.annuallyParticularMonth(template.setup.interval.annualInterval.selectMonth, instance);
        console.log("#13 - Deadline", deadline);
      } else if (template.setup.interval.annualInterval.selection === 'In a Particular Quarter') {
        deadline = timeCtrl.annuallyParticularQuarter(template.setup.interval.annualInterval.selectQuarter, instance);
      } else if (template.setup.interval.annualInterval.selection === '# of Days From Start') {
        deadline = timeCtrl.annuallyDaysFromStart(template.setup.interval.annualInterval.fromBeginning, instance);
      } else if (template.setup.interval.annualInterval.selection === '# of Days Before End') {
        deadline = timeCtrl.annuallyDaysBeforeEnd(template.setup.interval.annualInterval.fromEnd, instance);
      } else {
        deadline = timeCtrl.annuallyAnyDay(instance);
      }
    } else if (intervalType === 'Daily') {
      deadline = timeCtrl.nextDay();
    } else if (intervalType === 'Daily Business Day') {
      deadline = timeCtrl.nextBusinessDay();
    }
    deferred.resolve(deadline);
    return deferred.promise;
  },
  triggeredProject: function triggeredProject(date) {
    var deadline = '';
    if (template.setup.dueDate.target === 'Today') {
      date = timeCtrl.deadlineToday();
    } else if (template.setup.dueDate.target === 'Specific Date') {
      date = timeCtrl.dateDeadline(date);
    }
    deadline = template.setup.dueDate.actual;
    return deadline;
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlcl9hc3NldHMvY29udHJvbGxlcnMvcHJvamVjdEhlbHBlcnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNLFdBQVcsUUFBUSxVQUFSLENBQVg7QUFDTixJQUFNLFdBQVcsUUFBUSx1QkFBUixDQUFYO0FBQ04sSUFBTSxXQUFXLFFBQVEsdUJBQVIsQ0FBWDtBQUNOLElBQU0sZUFBZSxRQUFRLDJCQUFSLENBQWY7QUFDTixJQUFNLGNBQWMsUUFBUSwwQkFBUixDQUFkO0FBQ04sSUFBTSxJQUFJLFFBQVEsR0FBUixDQUFKO0FBQ04sSUFBTSxXQUFXLFFBQVEsNEJBQVIsQ0FBWDtBQUNOLElBQU0sZUFBZSxRQUFRLGNBQVIsQ0FBZjs7QUFFTixPQUFPLE9BQVAsR0FBaUI7QUFFZixzQ0FBYSxJQUFJO0FBQ2YsWUFBUSxHQUFSLENBQVksOEJBQVosRUFEZTtBQUVmLFFBQUksV0FBVyxFQUFFLEtBQUYsRUFBWCxDQUZXO0FBR2IsYUFBUyxRQUFULENBQWtCLEVBQWxCLEVBQ0csSUFESCxHQUVHLElBRkgsQ0FFUSxVQUFDLFFBQUQsRUFBYztBQUNsQixVQUFNLFlBQVksU0FBUyxLQUFULENBREE7QUFFbEIsZUFBUyxPQUFULENBQWlCLFNBQWpCLEVBRmtCO0tBQWQsQ0FGUixDQUhhO0FBU2IsV0FBTyxTQUFTLE9BQVQsQ0FUTTtHQUZGO0FBY2IsMERBQXVCLElBQUkscUJBQXFCO0FBQzlDLFlBQVEsR0FBUixDQUFZLHVDQUFaLEVBRDhDO0FBRTlDLFFBQUksV0FBVyxFQUFFLEtBQUYsRUFBWCxDQUYwQztBQUc5QyxpQkFBYSxRQUFiLENBQXNCLEVBQXRCLEVBQ0csSUFESCxHQUVHLElBRkgsQ0FFUSxVQUFDLFlBQUQsRUFBa0I7QUFDdEIsVUFBTSxhQUFhLGFBQWEsUUFBYixFQUFiLENBRGdCO0FBRXRCLGFBQU8sV0FBVyxHQUFYLENBRmU7QUFHdEIsYUFBTyxXQUFXLEdBQVgsQ0FIZTtBQUl0QixhQUFPLFdBQVcsSUFBWCxDQUFn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QUFxRCxzQkFBckQsRUFBNkU7QUFDdEYsbUJBQVcsU0FBUyxxQkFBVCxDQUErQixTQUFTLEtBQVQsQ0FBZSxRQUFmLENBQXdCLGNBQXhCLENBQXVDLE9BQXZDLEVBQWdELFFBQS9FLENBQVgsQ0FEc0Y7T0FBakYsTUFFQTtBQUNMLG1CQUFXLFNBQVMsY0FBVCxDQUF3QixRQUF4QixDQUFYLENBREs7T0FGQTtLQWZGLE1Bb0JBLElBQUksaUJBQWlCLE9BQWpCLEVBQTBCO0FBQ2pDLGlCQUFXLFNBQVMsT0FBVCxFQUFYLENBRGlDO0tBQTlCLE1BRUEsSUFBSSxpQkFBaUIsb0JBQWpCLEVBQXVDO0FBQzlDLGlCQUFXLFNBQVMsZUFBVCxFQUFYLENBRDhDO0tBQTNDO0FBR1AsYUFBUyxPQUFULENBQWlCLFFBQWpCLEVBekVpQztBQTBFakMsV0FBTyxTQUFTLE9BQVQsQ0ExRTBCO0dBN0R0QjtBQTBJYiw4Q0FBaUIsTUFBTTtBQUNyQixRQUFJLFdBQVcsRUFBWCxDQURpQjtBQUVyQixRQUFJLFNBQVMsS0FBVCxDQUFlLE9BQWYsQ0FBdUIsTUFBdkIsS0FBa0MsT0FBbEMsRUFBMkM7QUFDN0MsYUFBTyxTQUFTLGFBQVQsRUFBUCxDQUQ2QztLQUEvQyxNQUVPLElBQUksU0FBUyxLQUFULENBQWUsT0FBZixDQUF1QixNQUF2QixLQUFrQyxlQUFsQyxFQUFtRDtBQUM1RCxhQUFPLFNBQVMsWUFBVCxDQUFzQixJQUF0QixDQUFQLENBRDREO0tBQXZEO0FBR1AsZUFBVyxTQUFTLEtBQVQsQ0FBZSxPQUFmLENBQXVCLE1BQXZCLENBUFU7QUFRckIsV0FBTyxRQUFQLENBUnFCO0dBMUlWO0NBQWpCIiwiZmlsZSI6InNlcnZlcl9hc3NldHMvY29udHJvbGxlcnMvcHJvamVjdEhlbHBlcnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcbmNvbnN0IEVtcGxveWVlID0gcmVxdWlyZSgnLi4vbW9kZWxzL0VtcGxveWVlLmpzJyk7XHJcbmNvbnN0IFRlbXBsYXRlID0gcmVxdWlyZSgnLi4vbW9kZWxzL1RlbXBsYXRlLmpzJyk7XHJcbmNvbnN0IFRlbXBsYXRlVGFzayA9IHJlcXVpcmUoJy4uL21vZGVscy9UZW1wbGF0ZVRhc2suanMnKTtcclxuY29uc3QgUHJvamVjdFRhc2sgPSByZXF1aXJlKCcuLi9tb2RlbHMvUHJvamVjdFRhc2suanMnKTtcclxuY29uc3QgUSA9IHJlcXVpcmUoJ3EnKTtcclxuY29uc3QgdGltZUN0cmwgPSByZXF1aXJlKCcuLi9jb250cm9sbGVycy90aW1lQ3RybC5qcycpO1xyXG5jb25zdCByYW5kb21zdHJpbmcgPSByZXF1aXJlKCdyYW5kb21zdHJpbmcnKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cclxuICBnZXRUYXNrQXJyYXkoaWQpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiIzE2IC0gTWFkZSBpdCB0aGUgVGFzayBBcnJheVwiKTtcclxuICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcclxuICAgICAgVGVtcGxhdGUuZmluZEJ5SWQoaWQpXHJcbiAgICAgICAgLmV4ZWMoKVxyXG4gICAgICAgIC50aGVuKCh0ZW1wbGF0ZSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgdGFza0FycmF5ID0gdGVtcGxhdGUudGFza3M7XHJcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRhc2tBcnJheSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfSxcclxuXHJcbiAgICBtYWtlVGVtcGxhdGVUYXNrT2JqZWN0KGlkLCBhc3NvY2lhdGVkUHJvamVjdElkKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiIzE4IC0gTWFkZSBpdCB0byBUZW1wbGF0ZSBUYXNrIE9iamVjdFwiKTtcclxuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xyXG4gICAgICBUZW1wbGF0ZVRhc2suZmluZEJ5SWQoaWQpXHJcbiAgICAgICAgLmV4ZWMoKVxyXG4gICAgICAgIC50aGVuKChyZXR1cm5lZFRhc2spID0+IHtcclxuICAgICAgICAgIGNvbnN0IHRhc2tfcGxhaW4gPSByZXR1cm5lZFRhc2sudG9PYmplY3QoKTtcclxuICAgICAgICAgIGRlbGV0ZSB0YXNrX3BsYWluLl9pZDtcclxuICAgICAgICAgIGRlbGV0ZSB0YXNrX3BsYWluLl9fdjtcclxuICAgICAgICAgIGRlbGV0ZSB0YXNrX3BsYWluLmRhdGUuY3JlYXRlZDtcclxuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodGFza19wbGFpbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfSxcclxuXHJcbiAgICBtYWtlUHJvamVjdE9iamVjdChpZCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcIiMyIC0gTWFrZSBQcm9qZWN0IE9iamVjdCBDYWxsZWRcIik7XHJcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcclxuICAgICAgVGVtcGxhdGUuZmluZEJ5SWQoaWQpXHJcbiAgICAgICAgLmV4ZWMoKVxyXG4gICAgICAgIC50aGVuKCh0ZW1wbGF0ZSkgPT4ge1xyXG4gICAgICAgICAgdmFyIG5ld19PYmplY3QgPSB0ZW1wbGF0ZS50b09iamVjdCgpO1xyXG4gICAgICAgICAgZGVsZXRlIG5ld19PYmplY3QuX2lkO1xyXG4gICAgICAgICAgZGVsZXRlIG5ld19PYmplY3QuX192O1xyXG4gICAgICAgICAgZGVsZXRlIG5ld19PYmplY3QudGFza3M7XHJcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKG5ld19PYmplY3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH0sXHJcblxyXG4gICAgbWFrZVByb2plY3RUYXNrKG9iamVjdCwgYXNzb2NpYXRlZFByb2plY3RJZCl7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiIzIxIE1hZGUgaXQgdG8gTWFrZSBQcm9qZWN0IFRhc2tcIiwgb2JqZWN0LCBcIkFTU09DSUFURURQUk9KRUNUSURcIiwgYXNzb2NpYXRlZFByb2plY3RJZCk7XHJcbiAgICAgIHZhciBkZWZlcnJlZCA9IFEuZGVmZXIoKTtcclxuICAgICAgdmFyIG5ld1Rhc2sgPSBuZXcgUHJvamVjdFRhc2sob2JqZWN0KTtcclxuICAgICAgbmV3VGFzay5mcmllbmRseUlkID0gcmFuZG9tc3RyaW5nLmdlbmVyYXRlKHtsZW5ndGg6IDUsIHJlYWRhYmxlOiB0cnVlfSk7XHJcbiAgICAgIG5ld1Rhc2suYXNzb2NpYXRlZFByb2plY3QgPSBhc3NvY2lhdGVkUHJvamVjdElkO1xyXG4gICAgICBjb25zb2xlLmxvZyhcIk5FVyBUQVNLIENSRUFURURcIiwgbmV3VGFzayk7XHJcbiAgICAgIG5ld1Rhc2suc2F2ZSgpXHJcbiAgICAgICAgLnRoZW4oKHRhc2spID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJESUQgV0UgTUFLRSBJVD9cIiwgdGFzayk7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodGFzay5faWQpO1xyXG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJFUlJPUlwiLCBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH0sXHJcblxyXG4gICAgbmV4dE9jY3VycmVuY2UodGVtcGxhdGUsIGluc3RhbmNlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiIzYgLSBOZXh0IE9jY3VyYW5jZSBDYWxsZWRcIik7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiIzcgLSBJbnRlcnZhbCBUeXBlIFwiLCB0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC50eXBlKTtcclxuICAgICAgdmFyIGRlZmVycmVkID0gUS5kZWZlcigpO1xyXG4gICAgICB2YXIgZGVhZGxpbmU7XHJcbiAgICAgIHZhciBpbnRlcnZhbFR5cGUgPSB0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC50eXBlO1xyXG4gICAgICB2YXIgcGF0aCA9IFwidGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWxcIjtcclxuICAgICAgY29uc29sZS5sb2coXCIjOCAtIFBhdGhcIiwgcGF0aCk7XHJcblxyXG4gICAgICBpZiAoaW50ZXJ2YWxUeXBlID09PSAnV2Vla2x5Jykge1xyXG4gICAgICAgIGlmICh0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC53ZWVrbHlJbnRlcnZhbCAhPT0gJ0FueScpIHtcclxuICAgICAgICAgIGRlYWRsaW5lID0gdGltZUN0cmwud2Vla2x5U3BlY2lmaWNEYXkodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwud2Vla2x5SW50ZXJ2YWwsIGluc3RhbmNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC53ZWVrbHlBbnlEYXkoaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChpbnRlcnZhbFR5cGUgPT09ICdCaS1XZWVrbHknKSB7XHJcbiAgICAgICAgaWYgKHRlbXBsYXRlLnNldHVwLmludGVydmFsLndlZWtseUludGVydmFsICE9PSAnQW55Jykge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5iaVdlZWtseVNwZWNpZmljRGF5KHRlbXBsYXRlLnNldHVwLmludGVydmFsLmJpV2Vla2x5SW50ZXJ2YWwsIGluc3RhbmNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5iaVdlZWtseUFueURheShpbnN0YW5jZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKGludGVydmFsVHlwZSA9PT0gJ01vbnRobHknKSB7XHJcbiAgICAgICAgaWYgKHRlbXBsYXRlLnNldHVwLmludGVydmFsLm1vbnRobHlJbnRlcnZhbC5zZWxlY3Rpb24gPT09IFwiRmlyc3QgRGF5IG9mIE1vbnRoXCIpIHtcclxuICAgICAgICAgIGRlYWRsaW5lID0gdGltZUN0cmwubW9udGhseUZpcnN0RGF5KCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC5tb250aGx5SW50ZXJ2YWwuc2VsZWN0aW9uID09PSBcIkxhc3QgRGF5IG9mIE1vbnRoXCIpIHtcclxuICAgICAgICAgIGRlYWRsaW5lID0gdGltZUN0cmwubW9udGhseUxhc3REYXkoaW5zdGFuY2UpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwubW9udGhseUludGVydmFsLnNlbGVjdGlvbiA9PT0gJyMgb2YgRGF5cyBGcm9tIFN0YXJ0Jykge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5tb250aGx5RGF5c0Zyb21TdGFydCh0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC5tb250aGx5SW50ZXJ2YWwuZnJvbUJlZ2lubmluZywgaW5zdGFuY2UpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwubW9udGhseUludGVydmFsLnNlbGVjdGlvbiA9PT0gJyMgb2YgRGF5cyBCZWZvcmUgRW5kJykge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5tb250aGx5RGF5c0JlZm9yZUVuZCh0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC5tb250aGx5SW50ZXJ2YWwuZnJvbUVuZCwgaW5zdGFuY2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBkZWFkbGluZSA9IHRpbWVDdHJsLm1vbnRobHlBbnlEYXkoaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChpbnRlcnZhbFR5cGUgPT09ICdTZW1pLU1vbnRobHknKSB7XHJcbiAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5zZW1pTW9udGhseUZpcnN0Q3ljbGUodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwuc2VtaU1vbnRobHlJbnRlcnZhbC5mcm9tQmVnaW5uaW5nKTtcclxuICAgICAgICB0ZW1wbGF0ZS5zZXR1cC5kdWVEYXRlLmFudGljaXBhdGVkID0gdGltZUN0cmwuc2VtaU1vbnRobHlTZWNvbmRDeWNsZSh0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC5zZW1pTW9udGhseUludGVydmFsLmZyb21FbmQpO1xyXG4gICAgICB9IGVsc2UgaWYgKGludGVydmFsVHlwZSA9PT0gJ1F1YXJ0ZXJseScpIHtcclxuICAgICAgICBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwucXVhcnRlcmx5SW50ZXJ2YWwuc2VsZWN0aW9uID09PSAnRmlyc3QgRGF5IG9mIHRoZSBRdWFydGVyJykge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5xdWFydGVybHlGaXJzdERheSgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwucXVhcnRlcmx5SW50ZXJ2YWwuc2VsZWN0aW9uID09PSAnTGFzdCBEYXkgb2YgdGhlIFF1YXJ0ZXInKSB7XHJcbiAgICAgICAgICBkZWFkbGluZSA9IHRpbWVDdHJsLnF1YXJ0ZXJseUxhc3REYXkoaW5zdGFuY2UpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwucXVhcnRlcmx5SW50ZXJ2YWwuc2VsZWN0aW9uID09PSAnIyBEYXlzIGZyb20gU3RhcnQnKSB7XHJcbiAgICAgICAgICBkZWFkbGluZSA9IHRpbWVDdHJsLnF1YXJ0ZXJseURheXNGcm9tU3RhcnQodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwucXVhcnRlcmx5SW50ZXJ2YWwuZnJvbUJlZ2lubmluZywgaW5zdGFuY2UpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwucXVhcnRlcmx5SW50ZXJ2YWwuc2VsZWN0aW9uID09PSAnIyBEYXlzIGZyb20gRW5kJykge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5xdWFydGVybHlEYXlzQmVmb3JlRW5kKHRlbXBsYXRlLnNldHVwLmludGVydmFsLnF1YXJ0ZXJseUludGVydmFsLmZyb21FbmQsIGluc3RhbmNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5xdWFydGVybHlBbnlEYXkoaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChpbnRlcnZhbFR5cGUgPT09ICdBbm51YWxseScpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIiMxMCAtIE1hZGUgaXQgdG8gdGhlIGNvcnJlY3QgdHlwZVwiKTtcclxuICAgICAgICBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwuYW5udWFsSW50ZXJ2YWwgPT09ICdGaXJzdCBEYXkgb2YgdGhlIFllYXInKSB7XHJcbiAgICAgICAgICBkZWFkbGluZSA9IHRpbWVDdHJsLmFubnVhbGx5Rmlyc3REYXkoaW5zdGFuY2UpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwuYW5udWFsSW50ZXJ2YWwuc2VsZWN0aW9uID09PSAnTGFzdCBEYXkgb2YgdGhlIFllYXInKSB7XHJcbiAgICAgICAgICBkZWFkbGluZSA9IHRpbWVDdHJsLmFubnVhbGx5TGFzdERheShpbnN0YW5jZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC5hbm51YWxJbnRlcnZhbC5zZWxlY3Rpb24gPT09ICdJbiBhIFBhcnRpY3VsYXIgTW9udGgnKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIiMxMSAtIE1ha2UgaXQgdG8gdGhlIGNvcnJlY3QgYW5udWFsIHNlbGVjdGlvbiFcIik7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygndGVtcGxhdGUnLCB0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC5hbm51YWxJbnRlcnZhbC5zZWxlY3RNb250aCk7XHJcbiAgICAgICAgICBkZWFkbGluZSA9IHRpbWVDdHJsLmFubnVhbGx5UGFydGljdWxhck1vbnRoKHRlbXBsYXRlLnNldHVwLmludGVydmFsLmFubnVhbEludGVydmFsLnNlbGVjdE1vbnRoLCBpbnN0YW5jZSk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIiMxMyAtIERlYWRsaW5lXCIsIGRlYWRsaW5lKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRlbXBsYXRlLnNldHVwLmludGVydmFsLmFubnVhbEludGVydmFsLnNlbGVjdGlvbiA9PT0gJ0luIGEgUGFydGljdWxhciBRdWFydGVyJykge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5hbm51YWxseVBhcnRpY3VsYXJRdWFydGVyKHRlbXBsYXRlLnNldHVwLmludGVydmFsLmFubnVhbEludGVydmFsLnNlbGVjdFF1YXJ0ZXIsIGluc3RhbmNlKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRlbXBsYXRlLnNldHVwLmludGVydmFsLmFubnVhbEludGVydmFsLnNlbGVjdGlvbiA9PT0gJyMgb2YgRGF5cyBGcm9tIFN0YXJ0Jykge1xyXG4gICAgICAgICAgZGVhZGxpbmUgPSB0aW1lQ3RybC5hbm51YWxseURheXNGcm9tU3RhcnQodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwuYW5udWFsSW50ZXJ2YWwuZnJvbUJlZ2lubmluZywgaW5zdGFuY2UpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc2V0dXAuaW50ZXJ2YWwuYW5udWFsSW50ZXJ2YWwuc2VsZWN0aW9uID09PSAnIyBvZiBEYXlzIEJlZm9yZSBFbmQnKSB7XHJcbiAgICAgICAgICBkZWFkbGluZSA9IHRpbWVDdHJsLmFubnVhbGx5RGF5c0JlZm9yZUVuZCh0ZW1wbGF0ZS5zZXR1cC5pbnRlcnZhbC5hbm51YWxJbnRlcnZhbC5mcm9tRW5kLCBpbnN0YW5jZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGRlYWRsaW5lID0gdGltZUN0cmwuYW5udWFsbHlBbnlEYXkoaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChpbnRlcnZhbFR5cGUgPT09ICdEYWlseScpIHtcclxuICAgICAgICAgIGRlYWRsaW5lID0gdGltZUN0cmwubmV4dERheSgpO1xyXG4gICAgICB9IGVsc2UgaWYgKGludGVydmFsVHlwZSA9PT0gJ0RhaWx5IEJ1c2luZXNzIERheScpIHtcclxuICAgICAgICAgIGRlYWRsaW5lID0gdGltZUN0cmwubmV4dEJ1c2luZXNzRGF5KCk7XHJcbiAgICAgIH1cclxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShkZWFkbGluZSk7XHJcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfSxcclxuXHJcbiAgICB0cmlnZ2VyZWRQcm9qZWN0KGRhdGUpIHtcclxuICAgICAgdmFyIGRlYWRsaW5lID0gJyc7XHJcbiAgICAgIGlmICh0ZW1wbGF0ZS5zZXR1cC5kdWVEYXRlLnRhcmdldCA9PT0gJ1RvZGF5Jykge1xyXG4gICAgICAgIGRhdGUgPSB0aW1lQ3RybC5kZWFkbGluZVRvZGF5KCk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc2V0dXAuZHVlRGF0ZS50YXJnZXQgPT09ICdTcGVjaWZpYyBEYXRlJykge1xyXG4gICAgICAgIGRhdGUgPSB0aW1lQ3RybC5kYXRlRGVhZGxpbmUoZGF0ZSk7XHJcbiAgICAgIH1cclxuICAgICAgZGVhZGxpbmUgPSB0ZW1wbGF0ZS5zZXR1cC5kdWVEYXRlLmFjdHVhbDtcclxuICAgICAgcmV0dXJuIGRlYWRsaW5lO1xyXG4gICAgfSxcclxuXHJcbn07XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
